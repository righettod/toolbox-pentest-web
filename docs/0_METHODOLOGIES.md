# Methodologies

> **Note**: Use the TOC provided by the GitHub MD file rendering named `Outline`.

## Methodology personal to assess a web app in whitebox mode

**Flow:**

```mermaid
flowchart LR
    A((Anonymous)) -->B(Authenticated with low privileges)
    B --> C(Authenticated with high privileges)
    C --> D(System read and write access)
    D --> E((System shell))
```

**Step 1:**

üíª Identify in code all features accessible anonymously and confirm access via an HTTP call.

**Step 2:**

üíª Search into elements identified in step 1 for vulnerability allowing to pass in an authenticated state (normal or privileged):

* In case of SQLI: Verify if stack queries are supported, if NOT verify the presence of a reset password feature or any feature allowing to retrieve/obtain some kind of access token...
* In case of serialization: Verify if control is performed on the data received (signature, HMAC...)...
* Take care to logic applied in order to identify any issue in it (ex: custom algo or predictable generated elements like reset token...).
* ...

**Step 3:**

üíª Search for a way (doc, install file, hard-coded, enumeration...) to obtain a user or a list of users in order to leverage the step 2.

**Step 4:**

üíª Use element gathered in steps 1+2+3 to obtain an authenticated session.

**Needed if required for the next step:** If the access was not privileged then repeat step 2+3 targeting feature accessible to the authenticated user in order to pass in privileged mode.

**Step 5:**

üíª Use element gathered in step 4 to look for a way to interact with the OS filesystem directly (ex: XXE) or via a relay like the DB (ex: custom extension).

**Step 6:**

üíª Use element gathered in step 5 to look for vulnerability to gain RCE and then a reverse shell.

## Methodology for SAML based authentication flow evaluation

### Documentation

* [Specifications bundle](https://docs.oasis-open.org/security/saml/v2.0/saml-2.0-os.zip).
  * [Glossary](https://docs.oasis-open.org/security/saml/v2.0/saml-glossary-2.0-os.pdf).
  * [Security and Privacy Considerations](https://docs.oasis-open.org/security/saml/v2.0/saml-sec-consider-2.0-os.pdf).
  * [Assertions and Protocols](https://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf).
  * [Authentication Context](https://docs.oasis-open.org/security/saml/v2.0/saml-authn-context-2.0-os.pdf).
  * [Bindings](https://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf).
  * [Metadata](https://docs.oasis-open.org/security/saml/v2.0/saml-metadata-2.0-os.pdf).
  * [Profiles](https://docs.oasis-open.org/security/saml/v2.0/saml-profiles-2.0-os.pdf).
  * [Conformance](https://docs.oasis-open.org/security/saml/v2.0/saml-conformance-2.0-os.pdf).

### Methodology: How to Hunt Bugs in SAML?

* [Part I](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/).
* [Part II](https://epi052.gitlab.io/notes-to-self/blog/2019-03-13-how-to-test-saml-a-methodology-part-two).
* [Part III](https://epi052.gitlab.io/notes-to-self/blog/2019-03-16-how-to-test-saml-a-methodology-part-three).

### Tools

* [Custom python utility script](../templates/inspect_saml_request_response.py).
* Burp extension named  [SAML Raider](https://portswigger.net/bappstore/c61cfa893bb14db4b01775554f7b802e).
* [SAML online toolkit](https://www.samltool.com/online_tools.php).
* [SAML online validator](https://samltool.io/).
* [SAML decoder and parser](https://www.scottbrady91.com/tools/saml-parser).
* [SAML developer tools](https://developer.pingidentity.com/en/tools.html).

### Different type of XML signatures

üí° Based on this [source](https://epi052.gitlab.io/notes-to-self/blog/2019-03-07-how-to-test-saml-a-methodology/#xml-signatures):

* An **enveloping signatures** is when the signature wraps the signed resource.
* An **enveloped signature** is when the signature itself is a descendant of the resource it‚Äôs signing.
* An **detached signature** is neither wrapping nor is it wrapped by the resource to be signed. Instead, it is wholly separate from the signed resource.

## Methodology for code review

> Based on the video, named [Code Review Strategies](https://pentesterlab.com/videos/280), from the [PentesterLab Code Review badge of PentesterLab](https://pentesterlab.com/badges/codereview).

![CodeReviewStrategies](CodeReviewStrategies.png)

ü§î Possible strategies:

1. **Weakness** identification orientation (horizontal approach):
    * Review the code of *all functions even if they are not called by a function using user input*.
    * ‚úÖ This provide a pretty good coverage.
    * ‚ùå It is time consuming so require to have the time to do it.
2. **Vulnerability** identification orientation (vertical top-down or down-top approach):
    * Review the code of *all functions in the call tree initiated by (top-down) or landing on (down-top) a user input*.
    * ‚úÖ This require less time and allow to focus on some parts of an app.
    * ‚ùå As the coverage is partial it do not provide a full feedback about the security of the app.
3. **Feature** orientation:
    * It use the *vulnerability identification orientation in vertical top-down approach* and review all the functions that are part of a targeted features (for example "password reset").
    * üí° It is the recommanded one when possible.
